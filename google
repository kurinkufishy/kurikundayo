<?php
function googleSearch($query) {
    $apiKey = 'AIzaSyDejG07KxtN_9-87YZPvavL1WngyMNL1l0'; // 先ほど取得したAPIキーを入力
    $cx = '07448084bde3148f1'; // カスタム検索エンジンIDを入力
    $url = "https://www.googleapis.com/customsearch/v1?key=$apiKey&cx=$cx&q=" . urlencode($query);

    $response = file_get_contents($url);
    $results = json_decode($response, true);

    if (isset($results['items'])) {
        return $results['items'];
    } else {
        return [];
    }
}

// 検索フォームと結果の表示
if (isset($_GET['q'])) {
    $query = $_GET['q'];
    $searchResults = googleSearch($query);
} else {
    $query = '';
    $searchResults = [];
}
?>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>サイト内検索</title>
</head>
<body>
    <form method="get" action="">
        <input type="text" name="q" value="<?php echo htmlspecialchars($query); ?>" placeholder="検索ワードを入力">
        <button type="submit">検索</button>
    </form>

    <?php if (!empty($searchResults)): ?>
        <h2>「<?php echo htmlspecialchars($query); ?>」の検索結果</h2>
        <ul>
            <?php foreach ($searchResults as $item): ?>
                <li>
                    <a href="<?php echo $item['link']; ?>"><?php echo htmlspecialchars($item['title']); ?></a><br>
                    <span><?php echo htmlspecialchars($item['snippet']); ?></span>
                </li>
            <?php endforeach; ?>
        </ul>
    <?php elseif ($query): ?>
        <p>結果が見つかりませんでした。</p>
    <?php endif; ?>
</body>
</html>
